# ABMS 도메인 모델

## [시스템 필드]

시스템 필드는 `BaseEntity`를 상속받는 모든 도메인 엔티티에 공통적으로 적용됩니다.

### 속성 (BaseEntity)

- `id`: `Long` 고유 식별자 (Auto Increment, AbstractEntity)
- `createdAt`: `LocalDateTime` 생성 일시 (not null, updatable = false)
- `updatedAt`: `LocalDateTime` 수정 일시 (not null)
- `createdBy`: `String` 생성자 ID (updatable = false)
- `updatedBy`: `String` 수정자 ID
- `deleted`: `Boolean` 삭제 여부 (default false)
- `deletedAt`: `LocalDateTime` 삭제 일시 (nullable)
- `deletedBy`: `String` 삭제자 ID (nullable)

---

## [직원 Aggregate]

## 직원 (Employee)

_Aggregate Root_

### 속성(필드)

- `departmentId`: `Long` 소속 부서 ID (not null)
- `name`: `String` 이름 (길이 10, not null)
- `email`: `Email` 이메일 (임베디드 값 객체, `email_address`, not null, unique)
- `joinDate`: `LocalDate` 입사일 (not null)
- `birthDate`: `LocalDate` 생년월일 (not null)
- `position`: `EmployeePosition` 직급 (Enum, STRING, not null)
- `type`: `EmployeeType` 고용 형태 (Enum, STRING, not null)
- `status`: `EmployeeStatus` 재직 상태 (Enum, STRING, not null)
- `grade`: `EmployeeGrade` 등급 (Enum, STRING, not null)
- `avatar`: `EmployeeAvatar` 프로필 이미지 (Enum, STRING, not null)
- `resignationDate`: `LocalDate` 퇴사일 (nullable)
- `memo`: `String` 메모 (TEXT, nullable)

### 행위(메서드)

- `static create()`: 직원 생성
- `resign()`: 퇴사 처리
- `takeLeave()`: 휴직 처리
- `activate()`: 재직 처리 (복직)
- `updateInfo()`: 정보 수정
- `promote()`: 승진/직급 변경
- `softDelete()`: 삭제 처리 (이메일 마스킹 처리됨)
- `restore()`: 복구 처리 (이메일 복원됨)

### 규칙/제약

- 이메일은 중복될 수 없음 (Unique)
- 삭제 시 이메일은 `deleted.{timestamp}.{original}` 형태로 변경됨
- 퇴사일은 입사일 이후여야 함

## 직급 이력 (PositionHistory)

_Entity_

### 속성(필드)

- `employeeId`: `Long` 직원 ID (not null)
- `period`: `Period` 적용 기간 (시작일 not null, 종료일 nullable)
- `position`: `EmployeePosition` 직급 (not null)

### 행위(메서드)
- `static create()`: 이력 생성

## EmployeePosition (Enum)
- `ASSOCIATE`, `SENIOR_ASSOCIATE`, `PRINCIPAL`, `TEAM_LEADER`, `CHIEF`, `DIRECTOR` 등

## EmployeeType (Enum)
- `FULL_TIME`, `FREELANCE`, `OUTSOURCING`, `PART_TIME`

---

## [부서 Aggregate]

## 부서 (Department)

_Aggregate Root_

### 속성(필드)

- `code`: `String` 부서 코드 (Natural ID, 길이 32, not null, unique)
- `name`: `String` 부서명 (길이 30, not null)
- `type`: `DepartmentType` 부서 유형 (Enum, STRING, not null)
- `leaderEmployeeId`: `Long` 부서장 직원 ID (nullable)
- `parent`: `Department` 상위 부서 (Self Reference, nullable)
- `children`: `List<Department>` 하위 부서 목록

### 행위(메서드)

- `static create()`: 부서 생성
- `assignLeader()`: 부서장 임명

### 규칙/제약

- 부서 코드는 유일해야 함
- 상위 부서와 양방향 관계 관리

## DepartmentType (Enum)
- `COMPANY`, `DIVISION`, `GROUP`, `TEAM`, `LAB`, `TF`

---

## [프로젝트 Aggregate]

## 프로젝트 (Project)

_Aggregate Root_

### 속성(필드)

- `partyId`: `Long` 고객사(Party) ID (not null)
- `leadDepartmentId`: `Long` 주관 부서 ID (not null)
- `code`: `String` 프로젝트 코드 (길이 50, not null, unique)
- `name`: `String` 프로젝트명 (길이 100, not null)
- `description`: `String` 설명 (길이 500, nullable)
- `status`: `ProjectStatus` 상태 (Enum, STRING, not null)
- `contractAmount`: `Money` 계약 금액 (임베디드, not null)
- `period`: `Period` 기간 (임베디드, not null)

### 행위(메서드)
- `static create()`: 프로젝트 생성
- `update()`: 정보 수정
- `complete()`: 완료 처리
- `cancel()`: 취소 처리

## ProjectStatus (Enum)
- `SCHEDULED`, `IN_PROGRESS`, `COMPLETED`, `CANCELLED`

---

## [계약 Aggregate]

## 계약 (Contract)

_Aggregate Root_

### 속성(필드)
- `projectId`: `Long` 프로젝트 ID (not null)
- `version`: `Integer` 계약 차수 (1부터 시작)
- `contractType`: `ContractType` 계약 유형 (Enum, STRING, not null)
- `contractDate`: `LocalDate` 계약일 (nullable)
- `contractAmount`: `Money` 계약 금액 (not null)
- `period`: `Period` 계약 기간 (not null)

### 행위(메서드)
- `static createInitial()`: 초기 계약 생성
- `static renew()`: 변경 계약 생성 (차수 증가)
- `update()`: 정보 수정

## ContractType (Enum)
- `INITIAL` (최초 계약)
- `AMENDMENT` (변경 계약)

---

## [투입 Aggregate]

## 프로젝트 투입 (ProjectAssignment)

_Aggregate Root_

### 속성(필드)
- `contractId`: `Long` 계약 ID (not null) - *프로젝트가 아닌 계약에 종속됨*
- `employeeId`: `Long` 직원 ID (not null)
- `assignmentRole`: `String` 역할 (nullable)
- `assignmentRate`: `Double` 투입률 (0.0 ~ 1.0, nullable)
- `period`: `Period` 투입 기간 (not null)
- `projectId`: `Long` (Removed - Contract을 통해 관리)

### 행위(메서드)
- `static assign()`: 투입 배정
- `unassign()`: 투입 해제 (기간 종료)
- `updateRate()`: 투입률 수정

---

## [협력사 Aggregate]

## 협력사 (Party)

_Aggregate Root_

### 속성(필드)
- `name`: `String` 협력사명 (not null)
- `ceoName`: `String` 대표자명
- `salesRepName`: `String` 영업대표명
- ... (기타 상세 정보 `Party` 엔티티 참조)

---

## [Chat Aggregate]

## 채팅 세션 (ChatSession)

_Aggregate Root_

### 속성(필드)
- `title`: `String` 세션 제목 (길이 200, not null)
- `sessionId`: `String` 외부 세션 ID (길이 100, not null)
- `favorite`: `Boolean` 즐겨찾기 여부 (default false)
- `messages`: `List<ChatMessage>` 메시지 목록

### 행위(메서드)
- `static create()`: 세션 생성
- `updateTitle()`: 제목 수정
- `toggleFavorite()`: 즐겨찾기 토글
- `addMessage()`: 메시지 추가

## 채팅 메시지 (ChatMessage)

_Entity_

### 속성(필드)
- `chatSession`: `ChatSession` 세션 참조 (ManyToOne)
- `role`: `Role` 발화자 역할 (USER, ASSISTANT)
- `content`: `String` 메시지 내용 (TEXT)
- `timestamp`: `LocalDateTime` 발화 시각

---

## [공통 Value Object]

### Money
- `amount`: `BigDecimal` 금액
- `wons()`: 원화 생성 팩토리

### Period
- `startDate`: `LocalDate` 시작일
- `endDate`: `LocalDate` 종료일 (nullable 가능)

### Email
- `address`: `String` 이메일 주소 (검증 로직 포함)
