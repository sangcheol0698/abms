# Backend Development Guide (Hexagonal Architecture)

ì´ ê°€ì´ë“œëŠ” \*\*Hexagonal Architecture(Ports and Adapters)\*\*ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ë°±ì—”ë“œ ê°œë°œ í‘œì¤€ì…ë‹ˆë‹¤.
**ì² ì €í•œ ê³„ì¸µ ë¶„ë¦¬**ë¥¼ í†µí•´ ìœ ì§€ë³´ìˆ˜ì„±ì„ ê·¹ëŒ€í™”í•˜ê³ , **Null Safety**ë¥¼ ë³´ì¥í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.

-----

## 1\. í•µì‹¬ ì›ì¹™ (Core Principles)

1.  **ì˜ì¡´ì„± ë°©í–¥ (Dependency Rule)**
  * `Adapter` $\rightarrow$ `Application` $\rightarrow$ `Domain`
  * **DTO ë¶„ë¦¬ ì›ì¹™:** Web ê³„ì¸µì˜ `Request` ê°ì²´ëŠ” ì ˆëŒ€ Service ê³„ì¸µìœ¼ë¡œ ë„˜ì–´ê°€ì§€ ì•ŠìŠµë‹ˆë‹¤. ë°˜ë“œì‹œ `Command` ê°ì²´ë¡œ ë³€í™˜ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
2.  **íŒ¨í‚¤ì§€ êµ¬ì¡° (Matrix Structure)**
  * **ìµœìƒìœ„:** ë ˆì´ì–´(Layer) êµ¬ë¶„ (`domain`, `application`, `adapter`)
  * **í•˜ìœ„:** ë„ë©”ì¸(Domain) êµ¬ë¶„ (`member`, `team` ë“±)
  * ëª¨ë“  ê³„ì¸µì´ ë„ë©”ì¸ ë‹¨ìœ„ë¡œ ì •ë ¬ë˜ì–´, ê¸°ëŠ¥ ì‚­ì œ ì‹œ í•´ë‹¹ íŒ¨í‚¤ì§€ë“¤ë§Œ ì œê±°í•˜ë©´ ë©ë‹ˆë‹¤.
3.  **Null Safety ì „ëµ (JSpecify)**
  * ëª¨ë“  íŒ¨í‚¤ì§€ì— `package-info.java`ë¥¼ í†µí•´ \*\*`@NullMarked`\*\*ë¥¼ ì ìš©í•©ë‹ˆë‹¤.
  * ê¸°ë³¸ì ìœ¼ë¡œ \*\*ëª¨ë“  ë³€ìˆ˜ì™€ ë°˜í™˜ê°’ì€ `Non-null`\*\*ì…ë‹ˆë‹¤.
  * **Service ê³„ì¸µ ë‚´ë¶€ì—ì„œëŠ” ë°©ì–´ì  ë¡œì§(`if (obj == null)`)ì„ ì‘ì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**
4.  **ì‹¤ìš©ì  íƒ€í˜‘ (Pragmatism)**
  * **JPA íƒ€í˜‘:** Domain Entityì— `@Entity` ì‚¬ìš©ì„ í—ˆìš©í•©ë‹ˆë‹¤. (ë§¤í•‘ ë¹„ìš© ì ˆê°)
  * **Adapter ê°„ì†Œí™”:** `JpaRepository`ë¥¼ ì§ì ‘ ìƒì†ë°›ì•„ ì‚¬ìš©í•˜ë©°, ë³µì¡í•œ ì¿¼ë¦¬ê°€ í•„ìš”í•  ë•Œë§Œ ë³„ë„ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë§Œë“­ë‹ˆë‹¤.

-----

## 2\. íŒ¨í‚¤ì§€ êµ¬ì¡° (Package Structure)

```text
com.example.project
  â”œâ”€â”€ ğŸ“¦ domain                 # [í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™]
  â”‚    â”œâ”€â”€ member               # (ë„ë©”ì¸ëª…)
  â”‚    â”‚    â”œâ”€â”€ Member.java     # Entity
  â”‚    â”‚    â””â”€â”€ package-info.java (@NullMarked)
  â”‚    â””â”€â”€ team
  â”‚         â””â”€â”€ ...
  â”‚
  â”œâ”€â”€ ğŸ“¦application
  â”‚    â”œâ”€â”€ member
  â”‚    â”‚    â”œâ”€â”€ service          # [Write] íšŒì›ê°€ì…, ì •ë³´ìˆ˜ì • (MemberService)
  â”‚    â”‚    â”œâ”€â”€ query            # [Read] íšŒì›ê²€ìƒ‰, ì¡°íšŒ (MemberQueryService)
  â”‚    â”‚    â”œâ”€â”€ outbound         # [Interface]
  â”‚    â”‚    â”‚    â”œâ”€â”€ MemberRepository.java       # (Commandìš© - JpaRepository)
  â”‚    â”‚    â”‚    â”œâ”€â”€ MemberQueryRepository.java  # (Queryìš© - ë³´í†µ QueryDSL)
  â”‚    â”‚    â”‚    â””â”€â”€ MemberMailSender.java       # ë©”ì¼ ë°œì†¡ ì¸í„°í˜ì´ìŠ¤
  â”‚    â”‚    â””â”€â”€ dto
  â”‚    â”‚         â”œâ”€â”€ command     # (Write Input) MemberJoinCommand
  â”‚    â”‚         â”œâ”€â”€ condition   # [Read Input] MemberSearchCondition (ê²€ìƒ‰ ì¡°ê±´)
  â”‚    â”‚         â””â”€â”€ info        # (Output) MemberInfo (ë‹¨ê±´), MemberView (ëª©ë¡)
  â”‚    â””â”€â”€ team
  â”‚         â””â”€â”€ ...  
  â”‚
  â””â”€â”€ ğŸ“¦ adapter      # [ì™¸ë¶€ í†µì‹  ë° êµ¬í˜„]
       â”œâ”€â”€ web             # (Inbound)
       â”‚    â”œâ”€â”€ common     # Global Config
       â”‚    â”œâ”€â”€ member     # (ë„ë©”ì¸ëª…)
       â”‚    â”‚    â”œâ”€â”€ MemberApi.java   # RestController
       â”‚    â”‚    â”œâ”€â”€ dto              # Request(In), Response(Out)
       â”‚    â”‚    â””â”€â”€ package-info.java (@NullMarked)
       â”‚    â””â”€â”€ team
       â”‚         â””â”€â”€ ...
       â”‚
       â””â”€â”€ infrastructure       # (Outbound)
            â”œâ”€â”€ member          # (ë„ë©”ì¸ëª…)
            â”‚    â”œâ”€â”€ SmtpMemberMailSender.java  # ë©”ì¼ ë°œì†¡ êµ¬í˜„ì²´
            â”‚    â””â”€â”€ MemberRepositoryImpl.java (QueryDSL í•„ìš” ì‹œì—ë§Œ ìƒì„±)
            â””â”€â”€ team
                 â””â”€â”€ ...
```

-----

## 3\. ë°ì´í„° íë¦„ ë° ë„¤ì´ë° (Data Flow & Naming)

**CQRS ì›ì¹™ì— ë”°ë¼ "ìƒíƒœ ë³€ê²½(Write)"ê³¼ "ë°ì´í„° ì¡°íšŒ(Read)"ì˜ íë¦„ì„ ì² ì €íˆ ë¶„ë¦¬í•©ë‹ˆë‹¤.**

### 3-1. Write Flow (ë“±ë¡, ìˆ˜ì •, ì‚­ì œ)

**"Requestë¥¼ ë°›ì•„ Commandë¡œ ë³€í™˜í•˜ê³ , Entityë¥¼ ì¡°ì‘í•œ í›„, Info(í˜¹ì€ ID)ë¥¼ ë°˜í™˜í•œë‹¤."**

| ë‹¨ê³„ | ìœ„ì¹˜ | ê°ì²´ëª… (Suffix) | ì—­í•  ë° íŠ¹ì§• |
| :--- | :--- | :--- | :--- |
| **1. ìš”ì²­** | Adapter (Web) | `~Request` | **JSON Body.** `@Valid` ê²€ì¦ ìˆ˜í–‰. (ì˜ˆ: `MemberJoinRequest`) |
| **2. ë³€í™˜** | Adapter (Web) | `Request` $\rightarrow$ `Command` | Web ê¸°ìˆ ì„ ì œê±°í•œ ìˆœìˆ˜ ë°ì´í„°ë¡œ ë³€í™˜. |
| **3. ì…ë ¥** | Application | `~Command` | **Service(Write)ì˜ Input.** ë¹„ì¦ˆë‹ˆìŠ¤ í–‰ìœ„ë¥¼ ìœ„í•œ ë¶ˆë³€ ê°ì²´. |
| **4. ì²˜ë¦¬** | Service (Cmd) | `~CommandService` | **Entity ë¡œë”© ë° ì €ì¥.** ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦ ë° ìƒíƒœ ë³€ê²½. |
| **5. ê²°ê³¼** | Application | `~Info` (or `Id`) | Serviceì˜ Output. (ì˜ˆ: `MemberInfo`) |
| **6. ì‘ë‹µ** | Adapter (Web) | `~Response` | `Info`ë¥¼ ë³€í™˜í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ ê·œê²©ì— ë§ê²Œ ì‘ë‹µ. |

### 3-2. Read Flow (ì¡°íšŒ, ê²€ìƒ‰)

**"ê²€ìƒ‰ ì¡°ê±´(Condition)ì„ ë°›ì•„, DBì—ì„œ ì§ì ‘ DTO(View/Info)ë¥¼ ì¡°íšŒí•˜ì—¬ ìµœì í™”í•œë‹¤."**

| ë‹¨ê³„ | ìœ„ì¹˜ | ê°ì²´ëª… (Suffix) | ì—­í•  ë° íŠ¹ì§• |
| :--- | :--- | :--- | :--- |
| **1. ìš”ì²­** | Adapter (Web) | `~SearchCondition` | **Query Params.** `@ModelAttribute`ë¡œ ë°”ì¸ë”©. |
| **2. ë³€í™˜** | Adapter (Web) | `Condition` ì „ë‹¬ | ë³„ë„ì˜ ë³€í™˜ ì—†ì´ Serviceë¡œ ì „ë‹¬í•˜ê±°ë‚˜, í•„ìš”ì‹œ App ê³„ì¸µ Conditionìœ¼ë¡œ ë§¤í•‘. |
| **3. ì…ë ¥** | Application | `~Condition` | **Service(Query)ì˜ Input.** ê²€ìƒ‰ ì¡°ê±´(Null í—ˆìš© í•„ë“œ ë‹¤ìˆ˜). |
| **4. ì²˜ë¦¬** | Service (Query) | `~QueryService` | **Entity ë¯¸ì‚¬ìš©.** Repositoryë¥¼ í†µí•´ DBì—ì„œ DTOë¥¼ ì§ì ‘ ì¡°íšŒ(`Projection`). |
| **5. ê²°ê³¼** | Application | `~View` / `~Info` | **ëª©ë¡:** ê°€ë²¼ìš´ `~View` (ì˜ˆ: `MemberView`)<br>**ë‹¨ê±´:** ìƒì„¸í•œ `~Info` (ì˜ˆ: `MemberInfo`) |
| **6. ì‘ë‹µ** | Adapter (Web) | `~Response` | í™”ë©´ ìš”êµ¬ì‚¬í•­ì— ë§ì¶° `View`ë‚˜ `Info`ë¥¼ ê°ì‹¸ì„œ ì‘ë‹µ. |

-----

### â€» í•µì‹¬ ë„¤ì´ë° ê·œì¹™ ìš”ì•½

1.  **Input (Serviceë¡œ ë“¤ì–´ê°€ëŠ” ê²ƒ)**
  * ìƒíƒœ ë³€ê²½(Write) $\rightarrow$ **`~Command`** (ìœ íš¨ì„±ì´ ë³´ì¥ëœ ë°ì´í„°)
  * ë°ì´í„° ì¡°íšŒ(Read) $\rightarrow$ **`~Condition`** (ê²€ìƒ‰ ì¡°ê±´, Null ê°€ëŠ¥)
2.  **Output (Serviceì—ì„œ ë‚˜ì˜¤ëŠ” ê²ƒ)**
  * ë‹¨ê±´ ìƒì„¸ / ë“±ë¡ ê²°ê³¼ $\rightarrow$ **`~Info`** (ëª¨ë“  í•„ë“œ í¬í•¨)
  * ëª©ë¡ ìš”ì•½ $\rightarrow$ **`~View`** (í•µì‹¬ í•„ë“œë§Œ í¬í•¨, ê°€ë²¼ì›€)

-----

## 4\. Null Safety êµ¬í˜„ ê°€ì´ë“œ

### 4-1. íŒ¨í‚¤ì§€ ì„¤ì • (`package-info.java`)

ê° íŒ¨í‚¤ì§€ í´ë”ë§ˆë‹¤ ì•„ë˜ íŒŒì¼ì„ ìƒì„±í•˜ì—¬, í•´ë‹¹ íŒ¨í‚¤ì§€ ë‚´ ëª¨ë“  ì½”ë“œê°€ ê¸°ë³¸ì ìœ¼ë¡œ **Nullì„ í—ˆìš©í•˜ì§€ ì•ŠìŒ**ì„ ì„ ì–¸í•©ë‹ˆë‹¤.

```java
@NullMarked
package com.example.project.domain.member;

import org.jspecify.annotations.NullMarked;
```

### 4-2. ì½”ë“œ ì‘ì„± ê·œì¹™

* **ê¸°ë³¸:** ì•„ë¬´ ì–´ë…¸í…Œì´ì…˜ì´ ì—†ìœ¼ë©´ `Non-null`ì…ë‹ˆë‹¤.
* **ì˜ˆì™¸:** Nullì´ ë“¤ì–´ì˜¬ ìˆ˜ ìˆëŠ” ê²½ìš°ì—ë§Œ `@Nullable`ì„ ë¶™ì…ë‹ˆë‹¤.

-----

### 5\. êµ¬í˜„ ì˜ˆì‹œ (Member Registration - Write Flow)

#### 1\) [Domain] í•µì‹¬ ì—”í‹°í‹°

`domain/member/Member.java`

ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì˜ ì›ì²œì´ë©°, JPA Entityë¥¼ ì‹¤ìš©ì ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

```java
package com.example.project.domain.member;

import jakarta.persistence.*;
import lombok.Getter;
import lombok.NoArgsConstructor;
import org.jspecify.annotations.Nullable;

@Entity
@Getter
@NoArgsConstructor(access = lombok.AccessLevel.PROTECTED)
@Table(name = "member")
public class Member {
    
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    @Embedded
    @AttributeOverride(name = "address", column = @Column(name = "email", nullable = false, length = 100))
    private Email email;
    
    @Nullable
    private String nickname;
    
    private Long teamId; // ë‹¤ë¥¸ Aggregate ì°¸ì¡° ì‹œ ê°ì²´ ì°¸ì¡°ê°€ ì•„ë‹Œ id ì°¸ì¡°

    public Member(String name, String email, @Nullable String nickname, Long teamId) {
        this.name = requireNonNull(name);
        this.email = new Email(requireNonNull(email));
        this.nickname = nickname;
        this.teamId = requireNonNull(teamId);
    }
}
```

#### 2\) [Adapter: Web] Request DTO (Inbound)

`adapter/web/member/dto/MemberJoinRequest.java`

ì›¹ ìš”ì²­ì„ ë°›ì•„ ê²€ì¦(`@Valid`)í•˜ê³ , Serviceê°€ ì´í•´í•  ìˆ˜ ìˆëŠ” `Command`ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

```java
package com.example.project.adapter.web.member.dto;

import com.example.project.application.member.dto.command.MemberJoinCommand;
import jakarta.validation.constraints.Email;
import jakarta.validation.constraints.NotBlank;

public record MemberJoinRequest(
    @NotBlank(message = "ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.")
    String name,

    @NotBlank(message = "ì´ë©”ì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.")
    @Email(message = "ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.")
    String email
) {
    // Request(Web) -> Command(App) ë³€í™˜
    public MemberJoinCommand toCommand() {
        return new MemberJoinCommand(name, email);
    }
}
```

#### 3\) [Application] Command DTO (Write Input)

`application/member/dto/command/MemberJoinCommand.java`

Service ê³„ì¸µì˜ **Input**ì…ë‹ˆë‹¤. ì›¹ ê¸°ìˆ (Validation ë“±)ì´ ì œê±°ëœ ìˆœìˆ˜ ë°ì´í„°ì…ë‹ˆë‹¤.

```java
package com.example.project.application.member.dto.command;

public record MemberJoinCommand(
    String name,
    String email
) {}
```

#### 4\) [Application] Info DTO (Output)

`application/member/dto/info/MemberInfo.java`

Service ê³„ì¸µì˜ **Output**ì…ë‹ˆë‹¤. Entityë¥¼ ì§ì ‘ ë‚´ë³´ë‚´ì§€ ì•Šê³  í•„ìš”í•œ ë°ì´í„°ë§Œ ë‹´ìŠµë‹ˆë‹¤.

```java
package com.example.project.application.member.dto.info;

import com.example.project.domain.member.Member;

public record MemberInfo(
    Long id,
    String name,
    String email,
    @Nullable String nickname,
    Long teamId
) {
    // Entity -> Info ë³€í™˜
    public static MemberInfo of(Member member) {
        return new MemberInfo(
            member.getId(),
            member.getName(),
            member.getEmail(),
            member.getNickname(),
            member.getTeamId()
        );
    }
}
```

#### 5\) [Application] Outbound Interface (Command Repository)

`application/member/outbound/MemberRepository.java`

**Write(CUD)** ì‘ì—…ì„ ë‹´ë‹¹í•˜ëŠ” ì €ì¥ì†Œ ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤. ì¡°íšŒìš© ë³µì¡í•œ ì¿¼ë¦¬ëŠ” ì—¬ê¸°ì— ë„£ì§€ ì•ŠìŠµë‹ˆë‹¤.

```java
package com.example.project.application.member.outbound;

import com.example.project.domain.member.Member;
import org.springframework.data.jpa.repository.Repository;

public interface MemberRepository extends Repository<Member, Long> {
    // íšŒì›ê°€ì… ì‹œ ì¤‘ë³µ ì²´í¬ë¥¼ ìœ„í•œ ë‹¨ìˆœ ì¡°íšŒëŠ” í—ˆìš©
    boolean existsByEmail(String email);
}
```

#### 6\) [Application] Service (Write Logic)

`application/member/service/MemberService.java`

\*\*ìƒíƒœ ë³€ê²½(Write)\*\*ì„ ë‹´ë‹¹í•˜ëŠ” ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ì½ê¸° ì „ìš© ë¡œì§(`MemberQueryService`)ê³¼ ë¶„ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```java
package com.example.project.application.member.service;

import com.example.project.application.member.dto.command.MemberJoinCommand;
import com.example.project.application.member.dto.info.MemberInfo;
import com.example.project.application.member.outbound.MemberRepository;
import com.example.project.domain.member.Member;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

@Service
@RequiredArgsConstructor
@Transactional // Write íŠ¸ëœì­ì…˜ (ê¸°ë³¸)
public class MemberService {

    private final MemberRepository memberRepository;

    /**
     * íšŒì› ê°€ì… (Command ì²˜ë¦¬)
     */
    public MemberInfo join(MemberJoinCommand command) {
        // 1. ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦
        if (memberRepository.existsByEmail(command.email())) {
            throw new DuplicateEmailException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤.");
        }

        // 2. ë„ë©”ì¸(Entity) ìƒì„±
        Member member = new Member(
            command.name(),
            command.email(),
            null, // nickname
            command.teamId()
        );

        // 3. ì €ì¥ ë° ê²°ê³¼ ë°˜í™˜
        // CQRS ì •ì±…ì— ë”°ë¼ IDë§Œ ë°˜í™˜í•  ìˆ˜ë„ ìˆê³ , í¸ì˜ìƒ Infoë¥¼ ë°˜í™˜í•  ìˆ˜ë„ ìˆìŒ.
        // ì—¬ê¸°ì„œëŠ” Info ë°˜í™˜ ì±„íƒ.
        return MemberInfo.of(memberRepository.save(member));
    }
}
```

#### 7\) [Adapter: Web] Response DTO (Outbound)

`adapter/web/member/dto/MemberJoinResponse.java`

í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë‚´ë ¤ì¤„ JSON ìŠ¤í™ì…ë‹ˆë‹¤.

```java
package com.example.project.adapter.web.member.dto;

import com.example.project.application.member.dto.info.MemberInfo;

public record MemberJoinResponse(
    Long memberId,
    String message
) {
    public static MemberJoinResponse of(MemberInfo info) {
        return new MemberJoinResponse(info.id(), "íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
    }
}
```

#### 8\) [Adapter: Web] Controller

`adapter/web/member/MemberApi.java`

```java
package com.example.project.adapter.web.member;

import com.example.project.adapter.web.member.dto.MemberJoinRequest;
import com.example.project.adapter.web.member.dto.MemberJoinResponse;
import com.example.project.application.member.dto.command.MemberJoinCommand;
import com.example.project.application.member.dto.info.MemberInfo;
import com.example.project.application.member.service.MemberService; // Write Service ì£¼ì…
import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import org.springframework.http.HttpStatus;
import org.springframework.web.bind.annotation.*;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/members")
public class MemberApi {

    private final MemberService memberService;

    @PostMapping
    @ResponseStatus(HttpStatus.CREATED)
    public MemberJoinResponse join(@RequestBody @Valid MemberJoinRequest request) {
        // [Flow 1] Web Request -> App Command ë³€í™˜
        MemberJoinCommand command = request.toCommand();

        // [Flow 2] Service ì‹¤í–‰ (Write)
        MemberInfo info = memberService.join(command);

        // [Flow 3] App Info -> Web Response ë³€í™˜
        return MemberJoinResponse.of(info);
    }
}
```

-----

### ìš”ì•½: ë°ì´í„° íë¦„ (Write Path)

1.  **Request (`Web`)**: ì‚¬ìš©ìê°€ `MemberJoinRequest` (JSON) ì „ì†¡ $\rightarrow$ `@Valid` ê²€ì¦.
2.  **Command (`App`)**: `Request.toCommand()` í˜¸ì¶œ $\rightarrow$ ìˆœìˆ˜ ë°ì´í„° `MemberJoinCommand` ìƒì„±.
3.  **Service (`App`)**: `MemberService.join(Command)` í˜¸ì¶œ.
  * `MemberRepository`(JPA)ë¥¼ í†µí•´ ì¤‘ë³µ ê²€ì‚¬.
  * `Member` Entity ìƒì„± ë° `save()`.
  * ì €ì¥ëœ Entityë¥¼ `MemberInfo`ë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜.
4.  **Response (`Web`)**: `MemberInfo`ë¥¼ `MemberJoinResponse`ë¡œ ë³€í™˜í•˜ì—¬ JSON ì‘ë‹µ.

\*â€» ì°¸ê³ : `MemberQueryService`, `MemberQueryRepository`, `MemberSearchCondition` ë“±ì€ \*\*íšŒì› ì¡°íšŒ API(GET)\**ë¥¼ êµ¬í˜„í•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.*

---

### 6. êµ¬í˜„ ì˜ˆì‹œ (Read Flow)

### ğŸ” Read Flow Overview (ë°ì´í„° íë¦„)

1.  **Request:** `GET /api/members?teamId=1` (ì›¹ ìš”ì²­)
2.  **Condition:** `MemberSearchCondition` (ê²€ìƒ‰ ì¡°ê±´ ê°ì²´)
3.  **Service:** `MemberQueryService` (Read Only íŠ¸ëœì­ì…˜)
4.  **Repository:** `MemberQueryRepository` (QueryDSL êµ¬í˜„ì²´)
5.  **DB Execution:** `select id, name, email, nickname... of member` (Entity ë§¤í•‘ ì—†ì´ í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì¡°íšŒ)
6.  **Projection:** ì¡°íšŒ ê²°ê³¼ë¥¼ ì¦‰ì‹œ `MemberView`(DTO)ë¡œ ë§¤í•‘
7.  **Response:** `MemberResponse` (JSON ì‘ë‹µ)

-----

### 1\. Domain (Value Object ë³´ê°•)

`Member` ì—”í‹°í‹° ë‚´ì— `Email`ì´ë¼ëŠ” Value Objectê°€ ìˆìœ¼ë¯€ë¡œ, ì´ë¥¼ QueryDSLì—ì„œ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ëŠ”ì§€ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤.

```java
package com.example.project.domain.member;

import jakarta.persistence.Embeddable;
import lombok.Getter;
import lombok.NoArgsConstructor;

@Getter
@NoArgsConstructor(access = lombok.AccessLevel.PROTECTED)
@Embeddable
public record Email(@Column(name = "email", nullable = false) String address) {

    public Email {
        if (!EMAIL_PATTERN.matcher(address).matches()) {
            throw new IllegalArgumentException("ì´ë©”ì¼ í˜•ì‹ì´ ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤: " + address);
        }
    }
}
```

-----

### 2\. Application (Query Side)

Entityë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  \*\*DTO(Info)\*\*ì™€ \*\*ê²€ìƒ‰ ì¡°ê±´(Condition)\*\*ì„ ì •ì˜í•©ë‹ˆë‹¤.

#### [Input] ê²€ìƒ‰ ì¡°ê±´ (Condition)

`application.member.dto.condition.MemberSearchCondition`

```java
package com.example.project.application.member.dto.condition;

import org.jspecify.annotations.Nullable;

public record MemberSearchCondition(
    @Nullable String name,     // ì´ë¦„ ê²€ìƒ‰
    @Nullable Long teamId      // íŒ€ ID ê²€ìƒ‰
) {}
```

#### [Output] ì¡°íšŒ ê²°ê³¼ (Info)

`application.member.dto.info.MemberView`

> **í•µì‹¬:** `Email` ê°ì²´ê°€ ì•„ë‹Œ `String email`ë¡œ í’€ì–´ì„œ ë‚´ë³´ëƒ…ë‹ˆë‹¤. (ClientëŠ” VOë¥¼ ëª¨ë¦„)

```java
package com.example.project.application.member.dto.info;

import org.jspecify.annotations.Nullable;

public record MemberView(
    Long id,
    String name,
    String email,            // VO ë‚´ë¶€ì˜ ê°’ë§Œ ì¶”ì¶œ
    @Nullable String nickname,
    Long teamId
) {}
```

#### [Outbound] Query Repository Interface

`application.member.outbound.MemberQueryRepository`

```java
package com.example.project.application.member.outbound;

import com.example.project.application.member.dto.condition.MemberSearchCondition;
import com.example.project.application.member.dto.info.MemberView;
import java.util.List;

public interface MemberQueryRepository {
    List<MemberView> search(MemberSearchCondition condition);
    
    Optional<MemberInfo> findById(Long id);
}
```

#### [Service] Query Service

`application.member.service.query.MemberQueryService`

```java
package com.example.project.application.member.service.query;

import com.example.project.application.member.dto.condition.MemberSearchCondition;
import com.example.project.application.member.dto.info.MemberView;
import com.example.project.application.member.outbound.MemberQueryRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import java.util.List;

@Service
@RequiredArgsConstructor
@Transactional(readOnly = true) // ì½ê¸° ì „ìš© íŠ¸ëœì­ì…˜ (ì„±ëŠ¥ ìµœì í™”)
public class MemberQueryService {

    private final MemberQueryRepository memberQueryRepository;

    public List<MemberView> searchMembers(MemberSearchCondition condition) {
        // ë‹¨ìˆœíˆ Repositoryì— ìœ„ì„í•˜ê±°ë‚˜, ì¡°íšŒ ì „ìš© ë¡œì§ì´ ìˆë‹¤ë©´ ìˆ˜í–‰
        return memberQueryRepository.search(condition);
    }
}
```

-----

### 3\. Adapter - Infrastructure (QueryDSL Implementation)

**ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„ì…ë‹ˆë‹¤.** `Entity`ë¥¼ ì¡°íšŒí•´ì„œ DTOë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, **DBì—ì„œ ë°”ë¡œ DTOë¥¼ ìƒì„±**í•©ë‹ˆë‹¤.

`adapter.infrastructure.member.MemberQueryRepositoryImpl`

```java
package com.example.project.adapter.infrastructure.member;

import com.example.project.application.member.dto.condition.MemberSearchCondition;
import com.example.project.application.member.dto.info.MemberView;
import com.example.project.application.member.outbound.MemberQueryRepository;
import com.querydsl.core.types.Projections;
import com.querydsl.core.types.dsl.BooleanExpression;
import com.querydsl.jpa.impl.JPAQueryFactory;

import lombok.RequiredArgsConstructor;

import org.springframework.stereotype.Repository;

import java.util.List;

import static com.example.project.domain.member.QMember.member;

@Repository
@RequiredArgsConstructor
public class MemberQueryRepositoryImpl implements MemberQueryRepository {

  private final JPAQueryFactory queryFactory;

  @Override
  public List<MemberView> search(MemberSearchCondition condition) {
    return queryFactory
            .select(Projections.constructor(MemberView.class,
                    member.id,
                    member.name,
                    member.email.address, // [ì¤‘ìš”] Embedded íƒ€ì… ë‚´ë¶€ì˜ í•„ë“œ ì ‘ê·¼
                    member.nickname,
                    member.teamId
            ))
            .from(member)
            .where(
                containsName(condition.name()),
                eqTeam(condition.teamId())
            )
            .fetch();
  }

  // --- Dynamic Query Conditions ---

  private BooleanExpression containsName(String name) {
    return name != null ? member.name.contains(name) : null;
  }

  private BooleanExpression eqTeam(Long teamId) {
    return teamId != null ? member.teamId.eq(teamId) : null;
  }

}
```

ë‚ ì¹´ë¡œìš´ ì§€ì  ê°ì‚¬í•©ë‹ˆë‹¤. ì œê°€ \*\*"Web ê³„ì¸µ(Response)ê³¼ Application ê³„ì¸µ(Info)ì˜ ë¶„ë¦¬ ì›ì¹™"\*\*ì„ ì„¤ëª…í•´ë†“ê³ , ì •ì‘ ì½”ë“œ ì˜ˆì‹œì—ì„œëŠ” `MemberView`ë¥¼ ë°”ë¡œ ë°˜í™˜í•˜ëŠ” ì‹¤ìˆ˜ë¥¼ ë²”í–ˆìŠµë‹ˆë‹¤.

**ControllerëŠ” ë°˜ë“œì‹œ `Info`ë¥¼ `Response`ë¡œ ë³€í™˜í•´ì„œ ë‚´ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤.** ê·¸ë˜ì•¼ ë‚´ë¶€ ë¡œì§(`Info`)ì´ ë°”ë€Œì–´ë„ API ìŠ¤í™(`Response`)ì€ ìœ ì§€ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ìˆ˜ì •ëœ **[Read] íë¦„ì˜ Web Adapter** ë¶€ë¶„ì…ë‹ˆë‹¤.

-----

### 4\. [Adapter: Web] Response DTO ìƒì„±

`adapter.web.member.dto.MemberResponse.java`

`MemberView`ì™€ í•„ë“œê°€ ê°™ë”ë¼ë„, **í™”ë©´(API) ìš”êµ¬ì‚¬í•­**ì— ë§ì¶° ë³„ë„ë¡œ ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

```java
package com.example.project.adapter.web.member.dto;

import com.example.project.application.member.dto.info.MemberView;
import org.jspecify.annotations.Nullable;

public record MemberResponse(
    Long id,
    String name,
    String email,
    @Nullable String nickname,
    Long teamId
) {
    // Info -> Response ë³€í™˜ (Factory Method)
    public static MemberResponse of(MemberView info) {
        return new MemberResponse(
            info.id(),
            info.name(),
            info.email(),
            info.nickname(),
            info.teamId()
        );
    }
}
```

-----

### 5\. [Adapter: Web] Controller ìˆ˜ì •

`adapter.web.member.MemberApi.java`

`List<MemberView>`ë¥¼ ë°›ì•„ì„œ `List<MemberResponse>`ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì´ ì¶”ê°€ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

```java
package com.example.project.adapter.web.member;

import com.example.project.adapter.web.member.dto.MemberResponse;
import com.example.project.application.member.dto.condition.MemberSearchCondition;
import com.example.project.application.member.dto.info.MemberView;
import com.example.project.application.member.service.query.MemberQueryService;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/members")
public class MemberApi {

    private final MemberQueryService memberQueryService;

    @GetMapping
    public List<MemberResponse> searchMembers(
            @ModelAttribute MemberSearchCondition condition
    ) {
        // 1. Service í˜¸ì¶œ (ê²°ê³¼: List<MemberView>)
        List<MemberView> MemberViews = memberQueryService.searchMembers(condition);

        // 2. Info -> Response ë³€í™˜ (Stream ì‚¬ìš©)
        return MemberViews.stream()
                .map(MemberResponse::of)
                .toList();
    }
}
```

### ì™œ ì´ë ‡ê²Œê¹Œì§€ ë¶„ë¦¬í•˜ë‚˜ìš”?

ë§Œì•½ `MemberView`ë¥¼ ê·¸ëŒ€ë¡œ ë°˜í™˜í•˜ë‹¤ê°€, \*\*"í™”ë©´ì— ë³´ì—¬ì¤„ ë•ŒëŠ” ì „í™”ë²ˆí˜¸ ë’·ìë¦¬ë¥¼ ê°€ë ¤ì¤˜"\*\*ë¼ëŠ” ìš”êµ¬ì‚¬í•­ì´ ìƒê¸°ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”?

1.  **ë¶„ë¦¬ ì•ˆ í–ˆì„ ë•Œ:** `MemberView` ë¡œì§ì„ ìˆ˜ì •í•´ì•¼ í•¨ $\rightarrow$ `MemberView`ë¥¼ ì“°ëŠ” ë‹¤ë¥¸ ë‚´ë¶€ ë¡œì§ë“¤ì´ ê¹¨ì§ˆ ìœ„í—˜ ë°œìƒ.
2.  **ë¶„ë¦¬ í–ˆì„ ë•Œ:** `MemberResponse.of()` ë©”ì„œë“œë§Œ ìˆ˜ì •í•˜ë©´ ë¨. (`MemberView`ëŠ” ì›ë³¸ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€)

---

### ìš”ì•½: Read Flowì—ì„œì˜ íŠ¹ì§•

1.  **Value Object ì²˜ë¦¬:** `member.email.address`ì²˜ëŸ¼ QueryDSLì—ì„œ Embedded í•„ë“œ ë‚´ë¶€ì— ì§ì ‘ ì ‘ê·¼í•˜ì—¬, DTOì˜ `String` í•„ë“œì— ê½‚ì•„ ë„£ìŠµë‹ˆë‹¤.
2.  **DTO Projection:** `Projections.constructor`ë¥¼ ì‚¬ìš©í•˜ì—¬ DB ì¡°íšŒ ì‹œì ì— `MemberView` ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ë¡œ ì¸í•´ ë¶ˆí•„ìš”í•œ Entity ìŠ¤ëƒ…ìƒ· ë¡œë”©ì´ë‚˜ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ê°€ ìƒëµë©ë‹ˆë‹¤.
3.  **Aggregate ì°¸ì¡°:** `teamId`ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë¯€ë¡œ, ë§Œì•½ íŒ€ ì´ë¦„ê¹Œì§€ ê°™ì´ ë³´ì—¬ì¤˜ì•¼ í•œë‹¤ë©´ `member.join(team)...`ì„ ìˆ˜í–‰í•˜ê³  DTO ìƒì„±ìì— `team.name`ì„ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤. (Aggregate ê²½ê³„ë¥¼ ë„˜ì–´ì„  ì¡°íšŒëŠ” Query Sideì—ì„œëŠ” ììœ ë¡­ê²Œ í—ˆìš©ë©ë‹ˆë‹¤.)