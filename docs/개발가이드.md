# Backend Development Guide (Hexagonal Architecture)

ì´ ê°€ì´ë“œëŠ” **Hexagonal Architecture (Ports and Adapters)**ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ë°±ì—”ë“œ ê°œë°œ í‘œì¤€ì…ë‹ˆë‹¤.
**ì² ì €í•œ ê³„ì¸µ ë¶„ë¦¬**ë¥¼ í†µí•´ ìœ ì§€ë³´ìˆ˜ì„±ì„ ê·¹ëŒ€í™”í•˜ê³ , **Null Safety**ë¥¼ ë³´ì¥í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.

---

## 1. í•µì‹¬ ì›ì¹™ (Core Principles)

1.  **ì˜ì¡´ì„± ë°©í–¥ (Dependency Rule)**
    *   `adapter` $\rightarrow$ `application` $\rightarrow$ `domain`
    *   **DTO ë¶„ë¦¬ ì›ì¹™:** Web ê³„ì¸µì˜ `Request` ê°ì²´ëŠ” ì ˆëŒ€ Application ê³„ì¸µìœ¼ë¡œ ë„˜ì–´ê°€ì§€ ì•ŠìŠµë‹ˆë‹¤. ë°˜ë“œì‹œ `Command` ê°ì²´ë¡œ ë³€í™˜ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
2.  **íŒ¨í‚¤ì§€ êµ¬ì¡° (Ports & Adapters)**
    *   **ìµœìƒìœ„:** ë ˆì´ì–´(Layer) êµ¬ë¶„ (`domain`, `application`, `adapter`)
    *   **í•˜ìœ„:** ë„ë©”ì¸(Domain) êµ¬ë¶„ (`employee`, `department` ë“±)
    *   **Inbound/Outbound:** Application ê³„ì¸µì€ `inbound` (Use Case/Interface), `outbound` (Port/Interface)ë¡œ í¬íŠ¸ë¥¼ ëª…í™•íˆ êµ¬ë¶„í•©ë‹ˆë‹¤.
3.  **Null Safety ì „ëµ (JSpecify)**
    *   ëª¨ë“  íŒ¨í‚¤ì§€ì— `package-info.java`ë¥¼ í†µí•´ **`@NullMarked`**ë¥¼ ì ìš©í•©ë‹ˆë‹¤.
    *   ê¸°ë³¸ì ìœ¼ë¡œ **ëª¨ë“  ë³€ìˆ˜ì™€ ë°˜í™˜ê°’ì€ `Non-null`**ì…ë‹ˆë‹¤.
    *   **Service ê³„ì¸µ ë‚´ë¶€ì—ì„œëŠ” ë°©ì–´ì  ë¡œì§(`if (obj == null)`)ì„ ì‘ì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**
4.  **CQRS íŒ¨í„´ ì ìš©**
    *   ëª…ë ¹(Command/Write)ê³¼ ì¡°íšŒ(Query/Read)ì˜ ëª¨ë¸ê³¼ í¬íŠ¸ë¥¼ ë¶„ë¦¬í•©ë‹ˆë‹¤.
    *   **Write:** `Manager` (Interface) $\rightarrow$ `Service` (Implementation)
    *   **Read:** `Finder` (Interface) $\rightarrow$ `Service` (Implementation)

---

## 2. íŒ¨í‚¤ì§€ êµ¬ì¡° (Package Structure)

```text
kr.co.abacus.abms
  â”œâ”€â”€ ğŸ“¦ domain                 # [í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ & ì—”í‹°í‹°]
  â”‚    â”œâ”€â”€ employee             # (ë„ë©”ì¸ëª…)
  â”‚    â”‚    â”œâ”€â”€ Employee.java   # Aggregate Root (Entity)
  â”‚    â”‚    â”œâ”€â”€ EmployeePosition.java # Enum
  â”‚    â”‚    â””â”€â”€ package-info.java (@NullMarked)
  â”‚    â””â”€â”€ shared               # ê³µí†µ Value Object (Email, Period ë“±)
  â”‚
  â”œâ”€â”€ ğŸ“¦ application            # [ë¹„ì¦ˆë‹ˆìŠ¤ ìœ ì¦ˆì¼€ì´ìŠ¤ & í¬íŠ¸]
  â”‚    â”œâ”€â”€ employee
  â”‚    â”‚    â”œâ”€â”€ EmployeeModifyService.java # [Service] Inbound êµ¬í˜„ì²´ (Write)
  â”‚    â”‚    â”œâ”€â”€ EmployeeQueryService.java  # [Service] Inbound êµ¬í˜„ì²´ (Read)
  â”‚    â”‚    â”œâ”€â”€ inbound          # [Input Port] Use Case Interfaces
  â”‚    â”‚    â”‚    â”œâ”€â”€ EmployeeManager.java  # (Write Interface)
  â”‚    â”‚    â”‚    â””â”€â”€ EmployeeFinder.java   # (Read Interface)
  â”‚    â”‚    â”œâ”€â”€ outbound         # [Output Port] Repository Interfaces
  â”‚    â”‚    â”‚    â””â”€â”€ EmployeeRepository.java
  â”‚    â”‚    â””â”€â”€ dto              # [Transfer Objects]
  â”‚    â”‚         â”œâ”€â”€ EmployeeCreateCommand.java # (Write Input)
  â”‚    â”‚         â”œâ”€â”€ EmployeeSearchCondition.java # (Read Input)
  â”‚    â”‚         â””â”€â”€ EmployeeDetail.java        # (Output)
  â”‚
  â””â”€â”€ ğŸ“¦ adapter                # [ì™¸ë¶€ í†µì‹  ë° êµ¬í˜„ì²´]
       â”œâ”€â”€ api                  # [Driving Adapter] Web/Rest API
       â”‚    â”œâ”€â”€ employee        # (ë„ë©”ì¸ëª…)
       â”‚    â”‚    â”œâ”€â”€ EmployeeApi.java # RestController
       â”‚    â”‚    â””â”€â”€ dto              # Request(In), Response(Out)
       â”‚
       â””â”€â”€ infrastructure       # [Driven Adapter] Persistence/External
            â”œâ”€â”€ employee        # (ë„ë©”ì¸ëª…)
            â”‚    â”œâ”€â”€ EmployeeRepositoryImpl.java # QueryDSL Repository êµ¬í˜„
            â”‚    â””â”€â”€ PoiEmployeeExcelExporter.java # ì—‘ì…€ êµ¬í˜„ì²´
            â””â”€â”€ ...
```

---

## 3. ë°ì´í„° íë¦„ ë° ë„¤ì´ë° (Data Flow & Naming)

**CQRS ì›ì¹™ì— ë”°ë¼ "ìƒíƒœ ë³€ê²½(Write)"ê³¼ "ë°ì´í„° ì¡°íšŒ(Read)"ì˜ íë¦„ì„ ì² ì €íˆ ë¶„ë¦¬í•©ë‹ˆë‹¤.**

### 3-1. Write Flow (ë“±ë¡, ìˆ˜ì •, ì‚­ì œ, ìƒíƒœ ë³€ê²½)

**"Requestë¥¼ ë°›ì•„ Commandë¡œ ë³€í™˜í•˜ê³ , Entityë¥¼ ì¡°ì‘í•œ í›„, IDë¥¼ ë°˜í™˜í•œë‹¤."**

| ë‹¨ê³„ | ìœ„ì¹˜ | ê°ì²´ëª…/ì—­í•  | ì—­í•  ë° íŠ¹ì§• |
| :--- | :--- | :--- | :--- |
| **1. ìš”ì²­** | Adapter (`api`) | `~Request` | **JSON Body.** `@Valid` ê²€ì¦ ìˆ˜í–‰. (ì˜ˆ: `EmployeeCreateRequest`) |
| **2. ë³€í™˜** | Adapter (`api`) | `toCommand()` | Web ì˜ì¡´ì„± ì—†ëŠ” ìˆœìˆ˜ ë°ì´í„° ê°ì²´ë¡œ ë³€í™˜. |
| **3. ì…ë ¥** | Application (`inbound`) | `~Command` | **Manager(Write Port)ì˜ Input.** ë¶ˆë³€ ê°ì²´ (`record`). |
| **4. í¬íŠ¸** | Application (`inbound`) | `~Manager` | **Interface.** ë¹„ì¦ˆë‹ˆìŠ¤ í–‰ìœ„(Use Case) ì •ì˜. (ì˜ˆ: `EmployeeManager`) |
| **5. ì²˜ë¦¬** | Application | `~Service` | **Implementation.** Entity ë¡œë”©/ì €ì¥, ë„ë©”ì¸ ë¡œì§ ì‹¤í–‰. (ì˜ˆ: `EmployeeModifyService`) |
| **6. ê²°ê³¼** | Application | `Long id` | ëª…ë ¹ì˜ ê²°ê³¼ë¡œ ë³´í†µ ì‹ë³„ì(ID)ë§Œ ë°˜í™˜. |
| **7. ì‘ë‹µ** | Adapter (`api`) | `~Response` | IDë¥¼ ê°ì‹¸ì„œ í‘œì¤€ í¬ë§·ìœ¼ë¡œ ì‘ë‹µ. (ì˜ˆ: `EmployeeCreateResponse`) |

### 3-2. Read Flow (ì¡°íšŒ, ê²€ìƒ‰)

**"ê²€ìƒ‰ ì¡°ê±´(Condition)ì„ ë°›ì•„, DBì—ì„œ ìµœì í™”ëœ DTO(Summary/Detail)ë¥¼ ì¡°íšŒí•œë‹¤."**

| ë‹¨ê³„ | ìœ„ì¹˜ | ê°ì²´ëª…/ì—­í•  | ì—­í•  ë° íŠ¹ì§• |
| :--- | :--- | :--- | :--- |
| **1. ìš”ì²­** | Adapter (`api`) | `~Request` | **Query Params.** (ì˜ˆ: `EmployeeSearchCondition` ì§ì ‘ ë°”ì¸ë”©) |
| **2. í¬íŠ¸** | Application (`inbound`) | `~Finder` | **Interface.** ì¡°íšŒ ì „ìš© Use Case ì •ì˜. (ì˜ˆ: `EmployeeFinder`) |
| **3. ì…ë ¥** | Application (`inbound`) | `~Condition` | **Finder(Read Port)ì˜ Input.** ê²€ìƒ‰ ì¡°ê±´. |
| **4. ì²˜ë¦¬** | Application | `~QueryService` | **Implementation.** Repositoryë¥¼ í†µí•´ DBì—ì„œ DTO ì§ì ‘ ì¡°íšŒ. |
| **5. ê²°ê³¼** | Application | `~Summary` / `~Detail` | **ëª©ë¡:** ê°€ë²¼ìš´ `Summary` <br>**ë‹¨ê±´:** ìƒì„¸í•œ `Detail` |
| **6. ì‘ë‹µ** | Adapter (`api`) | `~Response` | API ìŠ¤í™ì— ë§ì¶° ë°ì´í„°ë¥¼ ê°ì‹¸ì„œ ì‘ë‹µ. |

---

## 4. Null Safety êµ¬í˜„ ê°€ì´ë“œ

### 4-1. íŒ¨í‚¤ì§€ ì„¤ì • (`package-info.java`)

ê° íŒ¨í‚¤ì§€ í´ë”ë§ˆë‹¤ ì•„ë˜ íŒŒì¼ì„ ìƒì„±í•˜ì—¬, í•´ë‹¹ íŒ¨í‚¤ì§€ ë‚´ ëª¨ë“  ì½”ë“œê°€ ê¸°ë³¸ì ìœ¼ë¡œ **Nullì„ í—ˆìš©í•˜ì§€ ì•ŠìŒ**ì„ ì„ ì–¸í•©ë‹ˆë‹¤.

```java
@NullMarked
package kr.co.abacus.abms.domain.employee;

import org.jspecify.annotations.NullMarked;
```

### 4-2. ì½”ë“œ ì‘ì„± ê·œì¹™

*   **ê¸°ë³¸:** ì•„ë¬´ ì–´ë…¸í…Œì´ì…˜ì´ ì—†ìœ¼ë©´ `Non-null`ì…ë‹ˆë‹¤.
*   **ì˜ˆì™¸:** Nullì´ ë“¤ì–´ì˜¬ ìˆ˜ ìˆëŠ” ê²½ìš°ì—ë§Œ `@Nullable` (`org.jspecify.annotations.Nullable`)ì„ ëª…ì‹œí•©ë‹ˆë‹¤.

---

## 5. êµ¬í˜„ ê°€ì´ë“œ (Employee ì˜ˆì‹œ)

### 5-1. [Inbound Port] Use Case Interface

**Write (Manager)**: `application/employee/inbound/EmployeeManager.java`

```java
public interface EmployeeManager {
    Long create(EmployeeCreateCommand command);
    Long updateInfo(Long id, EmployeeUpdateCommand command);
    void promote(Long id, EmployeePosition newPosition, @Nullable EmployeeGrade newGrade);
    // ...
}
```

**Read (Finder)**: `application/employee/inbound/EmployeeFinder.java`

```java
public interface EmployeeFinder {
    EmployeeDetail findEmployeeDetail(Long id);
    Page<EmployeeSummary> search(EmployeeSearchCondition condition, Pageable pageable);
}
```

### 5-2. [Application Service] Implementation

**Write Service**: `application/employee/EmployeeModifyService.java`

```java
@Service
@Transactional
@RequiredArgsConstructor
public class EmployeeModifyService implements EmployeeManager {
    private final EmployeeRepository employeeRepository;

    @Override
    public Long create(EmployeeCreateCommand command) {
        // 1. ë„ë©”ì¸ ë¡œì§ ê²€ì¦ (ì¤‘ë³µ ë“±)
        validateDuplicateEmail(command.email());

        // 2. Entity ìƒì„±
        Employee employee = command.toEntity();

        // 3. ì €ì¥
        return employeeRepository.save(employee).getId();
    }
}
```

### 5-3. [Outbound Port] Repository Interface

`application/employee/outbound/EmployeeRepository.java`

```java
public interface EmployeeRepository extends Repository<Employee, Long> {
    Employee save(Employee employee);
    Optional<Employee> findById(Long id);
    boolean existsByEmail(Email email);
    
    // Custom Repository ê¸°ëŠ¥ í™•ì¥ (QueryDSL ë“±)
    // CustomEmployeeRepository ìƒì†
}
```

### 5-4. [Adapter] Web Controller

`adapter/api/employee/EmployeeApi.java`

```java
@RestController
@RequiredArgsConstructor
public class EmployeeApi {
    private final EmployeeManager employeeManager; // Inbound Port ì£¼ì…
    private final EmployeeFinder employeeFinder;   // Inbound Port ì£¼ì…

    @PostMapping("/api/employees")
    public EmployeeCreateResponse create(@RequestBody @Valid EmployeeCreateRequest request) {
        // Request -> Command ë³€í™˜ í›„ Manager í˜¸ì¶œ
        Long id = employeeManager.create(request.toCommand());
        return EmployeeCreateResponse.of(id);
    }

    @GetMapping("/api/employees")
    public PageResponse<EmployeeSearchResponse> search(
            @Valid EmployeeSearchCondition condition, 
            Pageable pageable
    ) {
        // Finder í˜¸ì¶œ -> Service -> Repository -> DB
        Page<EmployeeSummary> result = employeeFinder.search(condition, pageable);
        
        // Summary -> Response ë³€í™˜
        return PageResponse.of(result.map(EmployeeSearchResponse::of));
    }
}
```

### 5-5. [Adapter] Infrastructure (QueryDSL)

`adapter/infrastructure/employee/EmployeeRepositoryImpl.java`

*   QueryDSLì„ ì‚¬ìš©í•˜ì—¬ ë³µì¡í•œ ì¡°íšŒ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
*   ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, `Projections.constructor`ë¥¼ ì‚¬ìš©í•˜ì—¬ í•„ìš”í•œ DTO(`EmployeeSummary` ë“±)ë¥¼ ë°”ë¡œ ìƒì„±í•©ë‹ˆë‹¤.

---

**ë¬¸ì„œ ë²„ì „**: 1.2
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2026-02-10
